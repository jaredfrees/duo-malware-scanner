#include "header.h"
#include "kernel_module/shared_header.h"

void clearInputBuffer();

void main(){
	char userInput;
	int userInputSearch;
	char keyword[MAX_INPUT_SIZE];
					
	printf("WELCOME TO THE FREES-ELLISON DUO MALWARE SCANNER!\n\n");
	printf("This program allows you to scan and delete malicious programs off your device\n");
	printf("This program does the following:\n");
	printf("\t-Scans current running processes for malware based on keyword\n");
	printf("\t-Scans memory for malware based on keyword\n");
	printf("\t-Scans System Call and Interrupt tables for malware based on keyword\n\n");

  do {
  
  	printf("Please input one of the following commands:\n");
	  printf("\tFind Keyword Running Processes [p]\n");
	  printf("\tKill Processes [k]\n");
	  printf("\tScan System Call Table [s]\n");
	  printf("\tExit Program [q]\n");
	  scanf(" %c", &userInput);
	  clearInputBuffer();
	  
		switch(userInput) {
			
			case 'p':
				printf("Please enter a keyword: ");			       
				scanf("%s", keyword);
				printf("Enter 0 to search for exact match of processes.\nEnter 1 to also search for substrings: ");
				scanf(" %d", &userInputSearch); 
				clearInputBuffer();
				if (userInputSearch) {
					syscall(SYSCALL_TASK_SUBSTRING, keyword);
				} else {
				  syscall(SYSCALL_TASK_SCANNER, keyword);
				}
				
				break;
			case 'k':
				printf("Please enter a keyword: ");			       
				scanf("%s", keyword);
				syscall(SYSCALL_KILL_PROCESS, keyword);
				printf("\n");
				break;
			case 's':
			  printf("Please enter a keyword: ");			       
				scanf("%s", keyword);
				syscall(SYSCALL_PRINT_SYSCALLS, keyword);
				break;
			case 'i':
				break;
      case 'q':
        break;
			default:
				printf("NOT A VALID COMMAND!\n");			
				break;
									
		}
		printf("\n");
	} while(userInput != 'q');

}

void clearInputBuffer() {
  char c;
  while ((c = getchar()) != '\n' && c != EOF);
}


