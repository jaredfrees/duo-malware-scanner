#include "header.h"

#define HIJACKED_SYSCALL_TASK_SCANNER __NR_tuxcall
#define HIJACKED_SYSCALL_KILL_PROCESS __NR_mlockall
#define MAX_INPUT_SIZE 40

void clearInputBuffer();

void main(){
	char userInput;
	int userInputSearch;
	char keyword[MAX_INPUT_SIZE];
					
	printf("WELCOME TO THE FREES-ELLISON DUO MALWARE SCANNER!\n\n");
	printf("This program allows you to scan and delete malicious programs off your device\n");
	printf("This program does the following:\n");
	printf("\t-Scans current running processes for malware based on keyword\n");
	printf("\t-Scans memory for malware based on keyword\n");
	printf("\t-Scans System Call and Interrupt tables for malware based on keyword\n\n");

  do {
  
  	printf("Please input one of the following commands:\n");
	  printf("\tPrint Current Running Processes [p]\n");
	  printf("\tKill Processes [k]\n");
	  printf("\tScan System Call Table [s]\n");
	  printf("\tScan Interrupt Table [i]\n");
	  printf("\tExit Program [q]\n");
	  scanf(" %c", &userInput);
	  clearInputBuffer();
	  
		switch(userInput) {
			
			case 'p':
				printf("Please enter a keyword: ");			       
				scanf("%s", keyword);
				printf("Enter 0 to search for exact match of processes.\nEnter 1 to also search for substrings: ");
				scanf(" %d", &userInputSearch); 
				clearInputBuffer();
			  //printf("Processes matching keyword:\n\n");
				syscall(HIJACKED_SYSCALL_TASK_SCANNER, keyword, userInputSearch);
				printf("\n");

				break;
			case 'k':
				printf("Please enter a keyword: ");			       
				scanf("%s", keyword);
				syscall(HIJACKED_SYSCALL_KILL_PROCESS, keyword);
				printf("\n");
				break;
			case 's':
				break;
			case 'i':
				break;
      case 'q':
        break;
			default:
				printf("NOT A VALID COMMAND!\n");			
				break;
									
		}
	} while(userInput != 'q');

}

void clearInputBuffer() {
  char c;
  while ((c = getchar()) != '\n' && c != EOF);
}


